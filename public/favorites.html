<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gloscars - Detalhes do Filme</title>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script>
  (()=>{
    const logado = sessionStorage.getItem('isLoggedIn');
        if (logado !== '1' || !logado) {
            window.location.href = 'login.html';
            return;
        }
    })();
  document.addEventListener('DOMContentLoaded', () => {
      const admin = JSON.parse(sessionStorage.getItem('usuarioCorrente') || '{}');

      if (admin.admin === 0) {
          // Se estiver na página de registro, bloqueia
          if (window.location.pathname.endsWith('register.html')) {
              alert('Acesso negado. Você não é um admin.');
              window.location.href = 'index.html';
          }

          // Esconde o link de registro no menu
          const regLink = document.querySelector('a[href="register.html"]');
          if (regLink) regLink.style.display = 'none';
      }
  });
  </script>
</head>
<body class="bg-black text-white">
<header>
    <a href="index.html"><div class="logo">
        <img src="/assets/img/logo.svg" style="max-width: 180px; filter: brightness(50)">
    </div></a>
    <nav>
        <ul id="menuList">
            <a href="index.html" style="color: inherit; text-decoration: inherit;"><li>Início</li></a>
            <a href="register.html" style="color: inherit; text-decoration: inherit;"><li>Cadastro</li></a>
            <a href="favorites.html" style="color: inherit; text-decoration: inherit;"><li>Favorito</li></a>
            <a href="login.html" style="color: inherit; text-decoration: inherit;" class="mobile-logout"><li>Logout</li></a>
        </ul>
    </nav>

    <div class="hamburguer">
        <a onclick="toggleMenu()" class="btn-mobile-menu">
            <div class="icon icon-open">
                <svg style="width: 30px; height: 30px; fill: white;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"> <path d="M56 48c2.209 0 4 1.791 4 4 0 2.209-1.791 4-4 4-1.202 0-38.798 0-40 0-2.209 0-4-1.791-4-4 0-2.209 1.791-4 4-4C17.202 48 54.798 48 56 48zM56 32c2.209 0 4 1.791 4 4 0 2.209-1.791 4-4 4-1.202 0-38.798 0-40 0-2.209 0-4-1.791-4-4 0-2.209 1.791-4 4-4C17.202 32 54.798 32 56 32zM56 16c2.209 0 4 1.791 4 4 0 2.209-1.791 4-4 4-1.202 0-38.798 0-40 0-2.209 0-4-1.791-4-4 0-2.209 1.791-4 4-4C17.202 16 54.798 16 56 16z"></path> </svg>
            </div>
            <div class="icon icon-close">
                <svg style="width: 23px;height: 23px;fill: white;margin-right: 3px;margin-top: 2px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path d="M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"></path></svg>
            </div>
        </a>
    </div>
</header>

<main>
<section class="content">
    <div class="catalog">
        <!-- TITULO -->
        <div class="title-box">
            <h3>Seus filmes favoritos</h3>
            <span id="dateofmovies"></span>
        </div>

        <!-- FILMES -->
        <div class="collection-box">
            <div class="collection-line" id="colLine">
            </div>
        </div>
    </div>
</section>
</main>
<footer>
  <div class="footer-wrapper">
    <div class="footer-col">
      <h4>Sobre o Gloscars</h4>
      <p>
        O Gloscars traz os melhores filmes de cada ano, reunindo clássicos e novidades do cinema mundial para você explorar e se
        inspirar.
      </p>
    </div>
    <div class="footer-col">
      <div class="footer-infos2">
        <h4>Informações</h4>
        <p>
          <strong>Aluno:</strong> Francisco<br />
          <strong>Curso:</strong> Engenharia de Software<br />
          <strong>Turma:</strong> Noite
        </p>
      </div>
      <div class="footer-infos2">
        <h4>Redes Sociais</h4>
        <ul>
          <li><a href="https://facebook.com/">Facebook</a></li>
          <li><a href="https://instagram.com/">Instagram</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script>
function loadCollection(filmes) {
    colItem = '';
    let colLine = document.getElementById('colLine');
    for(let i = 0; i < filmes.length; i++) {
        filme = filmes[i];
        if(filme.favorite === 1) {
          colItem += `<a href="/detalhes.html?id=${filme.id}"><div class="collection-item">
                          <img src="${filme.poster}" class="poster" 
                          style="max-width: 100%; border-radius: var(--radius);"
                          onerror="this.onerror=null; this.src='/assets/img/placeholder.png';"></img>
                      </div></a>`;
        }
    }
    if(colItem != '') {
      colLine.innerHTML = colItem
    } else {
      colLine.innerHTML = "Nenhum filme favorito foi adicionado."
    }
}
    fetch('/filmes')
    .then(res => {
        if (!res.ok) {
        throw new Error(`Erro na resposta: ${res.status} ${res.statusText}`);
        }
        return res.json();
    })
    .then(data => {
        loadCollection(data);
    })
    .catch(err => {
        console.error("Erro ao carregar /filmes:", err);
        // opcional: feedback na UI
        document.querySelector('#erro').textContent = 
        "Não foi possível carregar os dados. Tente recarregar.";
    });
</script>
<script src="/assets/js/app.js"></script>
</body>
</html>
