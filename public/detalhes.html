<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gloscars - Detalhes do Filme</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
</head>
<style>
header {
    display: grid;
    grid-template-columns: 180px 1fr 60px; /* cada parametro determina um elemento: logo 200px, nav 1fr (1 fração//oq sobrar), 56px para a pesquisa */
    align-items: center;
    gap: var(--gap);
    padding: var(--gap);
    margin-top: 10px;
    position: relative;
}
.detalhes-title {
  color: white !important;
  font-weight: 700;
  font-size: 2.5rem;
  margin-bottom: 8px;
}

.detalhes-content {
  display: flex;
  gap: 25px;
  align-items: flex-start;
  flex-wrap: nowrap;
}

.detalhes-poster {
  width: 300px;
  border-radius: var(--radius);
  /* removido box-shadow conforme pedido */
  flex-shrink: 0;
}

.generos {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.genero-label {
  background-color: #444;
  color: #ddd;
  font-size: 0.85rem;
  padding: 4px 12px;
  border-radius: 5px;
  text-transform: capitalize;
}

.detalhes-info {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.detalhes-blocos {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 15px;
  margin-bottom: 25px;
  align-items: center;
}

.btn-trailer {
  background-color: #b39930;
  color: white !important;
  padding: 12px 18px;
  border-radius: var(--radius);
  font-weight: 600;
  text-decoration: none !important;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-style: normal;
  transition: background-color 0.3s ease;
  border: none;
  height: 80px;
  min-width: 110px;
  text-align: center;
}

.btn-trailer:hover {
  background-color: #9a7e27;
  color: #111 !important;
  cursor: pointer;
}

.btn-trailer svg {
  fill: white;
  width: 20px;
  height: 20px;
}

.bloco-vertical {
  background-color: #222;
  border-radius: var(--radius);
  height: 80px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  font-size: 1.1rem;
  color: white;
  user-select: none;
  padding: 0 10px;
  text-align: center;
  overflow-wrap: break-word;
}

.bloco-label {
  font-size: 0.65rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: #bbb;
  font-weight: 700;
  margin-bottom: 5px;
  white-space: normal;
  max-width: 100%;
}

.bloco-valor {
  font-size: 1.3rem;
  font-weight: 700;
  word-wrap: break-word;
}

.sinopse-section {
  margin-bottom: 30px;
}

.sinopse-header {
  font-size: 0.85rem;
  font-weight: 700;
  color: #b39930;
  letter-spacing: 4px;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.sinopse-text {
  color: rgba(255, 255, 255, 0.85);
  font-size: 1rem;
  line-height: 1.5;
  max-width: 600px;
}

.listas-info {
  display: flex;
  gap: 40px;
  flex-wrap: wrap;
  font-size: 0.9rem;
  font-weight: 500;
}

.lista-info strong {
  display: block;
  margin-bottom: 6px;
  text-transform: capitalize;
}

.lista-info ul {
  display: flex;
  gap: 10px;
  list-style: none;
  padding: 0;
  margin: 0;
  flex-wrap: wrap;
}

.lista-info li {
  white-space: nowrap;
}

/* Responsividade */

@media (max-width: 768px) {
  .detalhes-content {
    flex-direction: column;
    align-items: center;
  }

  .detalhes-poster {
    width: 100%;
    max-width: 350px;
    margin-bottom: 25px;
  }

  .detalhes-info {
    width: 100%;
  }
}
</style>
<body class="bg-black text-white">
<header>
  <div class="logo">
    <a href="index.html">
      <img src="/assets/img/logo.svg" style="max-width: 180px; filter: brightness(50)"/>
    </a>
  </div>
</header>

<main>
  <section id="detalhes"></section>

  <div>
    <h3 style="margin-bottom: 20px; margin-top: 15px;">Outros que podem te interessar: </h3>
    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner" id="carousel-inner"></div>

      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#carouselExampleControls"
        data-bs-slide="prev"
        style="background: linear-gradient(90deg, black, transparent);"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#carouselExampleControls"
        data-bs-slide="next"
        style="background: linear-gradient(270deg, black, transparent);"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
  </div>
</main>
<footer>
  <div class="footer-wrapper">
    <div class="footer-col">
      <h4>Sobre o Gloscars</h4>
      <p>
        O Gloscars traz os melhores filmes de cada ano, reunindo clássicos e novidades do cinema mundial para você explorar e se
        inspirar.
      </p>
    </div>
    <div class="footer-col">
      <div class="footer-infos2">
        <h4>Informações</h4>
        <p>
          <strong>Aluno:</strong> Francisco<br />
          <strong>Curso:</strong> Engenharia de Software<br />
          <strong>Turma:</strong> Noite
        </p>
      </div>
      <div class="footer-infos2">
        <h4>Redes Sociais</h4>
        <ul>
          <li><a href="https://facebook.com/">Facebook</a></li>
          <li><a href="https://instagram.com/">Instagram</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>

<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
  crossorigin="anonymous"
/>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
  crossorigin="anonymous"
></script>
<script>
  let filmes = [];

  fetch("http://localhost:3000/filmes")
    .then((res) => res.json())
    .then((data) => {
      filmes = data;
      loadCollection(filmes);
    });

  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  function loadCollection(filmes) {
    const ano = getQueryParam("y");
    const filme = filmes.find((f) => f.ano == ano);

    if (!filme) {
      document.getElementById("detalhes").innerHTML = "<p>Filme não encontrado.</p>";
      return;
    }

    // Gêneros como labels
    const generosHtml = filme.genero.map((g) => `<span class="genero-label">${g}</span>`).join("");

    // Diretor, roteiro, elenco como listas horizontais
    const diretores = Array.isArray(filme.diretor) ? filme.diretor : [filme.diretor];
    const roteiros = Array.isArray(filme.roteiro) ? filme.roteiro : [filme.roteiro];
    const elenco = Array.isArray(filme.elenco) ? filme.elenco : [filme.elenco];

    const html = `
      <div class="detalhes-content">
        <img src="${filme.poster}" alt="${filme.titulo}" class="detalhes-poster" />

        <div class="detalhes-info">

          <h1 class="detalhes-title">${filme.titulo}</h1>

          <div class="generos">${generosHtml}</div>

          <div class="detalhes-blocos">

            <a href="${filme.trailer}" target="_blank" class="btn-trailer" rel="noopener noreferrer">
              <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 163.861 163.861" style="enable-background:new 0 0 512 512" xml:space="preserve">
              <g><path d="M34.857 3.613C20.084-4.861 8.107 2.081 8.107 19.106v125.637c0 17.042 11.977 23.975 26.75 15.509L144.67 97.275c14.778-8.477 14.778-22.211 0-30.686L34.857 3.613z" fill="#fff" opacity="1"></path></g>
              </svg>
            </a>

            <div class="bloco-vertical">
              <span class="bloco-label">NOTA IMDB</span>
              <span class="bloco-valor">${filme.imdb}</span>
            </div>

            <div class="bloco-vertical">
              <span class="bloco-label">LANÇAMENTO</span>
              <span class="bloco-valor">${filme.lancamento}</span>
            </div>

            <div class="bloco-vertical">
              <span class="bloco-label">DURAÇÃO</span>
              <span class="bloco-valor">${filme.duracao} min</span>
            </div>

          </div>

          <div class="sinopse-section">
            <h2 class="sinopse-header">SINOPSE</h2>
            <p class="sinopse-text">${filme.sinopse}</p>
          </div>

          <div class="listas-info">
            <div class="lista-info">
              <strong>Diretor:</strong>
              <ul>${diretores.map((d) => `<li>${d}</li>`).join("")}</ul>
            </div>

            <div class="lista-info">
              <strong>Roteiro:</strong>
              <ul>${roteiros.map((r) => `<li>${r}</li>`).join("")}</ul>
            </div>

            <div class="lista-info">
              <strong>Elenco:</strong>
              <ul>${elenco.map((e) => `<li>${e}</li>`).join("")}</ul>
            </div>
          </div>

        </div>
      </div>
    `;

    document.getElementById("detalhes").innerHTML = html;

    loadCol(filme.ano);
  }

  function loadCol(anoAtual) {
  let html = "";
  let carousel = document.querySelector("#carousel-inner");
  if (!carousel) return;

  let porSlide = 4;
  const width = window.innerWidth;
  if (width <= 500) {
    porSlide = 1;
  } else if (width > 500 && width < 768) {
    porSlide = 2;
  } else {
    porSlide = 4;
  }

  let lista = filmes.filter(f => f.ano != anoAtual);

  let contador = 0;
  for (let i = 0; i < lista.length; i++) {
    if (contador === 0) {
      html += `<div class="carousel-item ${i === 0 ? "active" : ""}">
                  <div class="collection-line">`;
    }

    html += `<div class="collection-item">
               <a href="/detalhes.html?y=${lista[i].ano}">
                 <img src="${lista[i].poster}" alt="${lista[i].titulo}" class="poster rounded-3">
               </a>
             </div>`;

    contador++;

    if (contador === porSlide) {
      html += `</div></div>`;
      contador = 0;
    }
  }

  // Fecha o último grupo caso não tenha fechado dentro do loop
  if (contador !== 0) {
    html += `</div></div>`;
  }

  carousel.innerHTML = html;
}

// Chama loadCol ao carregar e ao redimensionar janela, sem recarregar página
window.addEventListener('resize', () => {
  const ano = getQueryParam('y');
  if (ano) loadCol(ano);
});

// Também chama na inicialização para garantir o carregamento correto
window.addEventListener('load', () => {
  const ano = getQueryParam('y');
  if (ano) loadCol(ano);
});
</script>
</body>
</html>
